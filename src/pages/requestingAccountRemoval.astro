---
import IndexLayout from '@/layouts/IndexLayout.astro'
import { themeConfig } from '@/config'

const appOrDeveloperName = themeConfig.site.title || 'Totem Grid'
const supportEmail = 'developer@totemgrid.dev'
const emailSubject = 'Account Removal Request:'
---

<IndexLayout
  title={`Request Account Deletion — ${appOrDeveloperName}`}
  description={`How to request deletion of your ${appOrDeveloperName} account and associated data.`}
>
  <main class="account-removal-page">
    <header class="hero card-depth" aria-labelledby="account-removal-heading">
      <div class="hero-inner">
        <h1 id="account-removal-heading">Request account deletion</h1>
        <p class="hero-subtitle">
          This page applies to the <strong>{appOrDeveloperName}</strong> app / developer shown on the App Store and Google Play.
        </p>
      </div>
    </header>

    <section class="content card-depth" aria-label="Account deletion steps and request form">
      <div class="content-inner">
        <section aria-labelledby="steps-heading">
          <h2 id="steps-heading">How to request deletion</h2>
          <ol class="steps">
            <li>Open the {appOrDeveloperName} app.</li>
            <li>Go to <strong>Profile</strong>.</li>
            <li>Copy your <strong>username</strong> and your <strong>ID code</strong>.</li>
            <li>Paste them into the form below and submit.</li>
          </ol>
          <p class="small">
            Submitting will open your email app with a pre-filled message to <strong>{supportEmail}</strong>. Please send the email to complete the request.
          </p>
        </section>

        <section class="form-section" aria-labelledby="form-heading">
          <h2 id="form-heading">Account deletion request form</h2>

          <form id="accountRemovalForm" class="form" novalidate>
            <div class="form-row">
              <label for="user_name">Username</label>
              <input
                id="user_name"
                name="user_name"
                type="text"
                autocomplete="username"
                placeholder="your_username"
                required
              />
            </div>

            <div class="form-row">
              <label for="user_id">ID code</label>
              <input
                id="user_id"
                name="user_id"
                type="text"
                inputmode="text"
                placeholder="your_id_code"
                required
              />
            </div>

            <button type="submit" class="submit">Submit request</button>

            <p class="form-message" id="formMessage" role="status" aria-live="polite"></p>
          </form>

          <div class="email-fallback" aria-label="Email template fallback">
            <p class="small">
              If you can’t use the form, email us directly at <a href={`mailto:${supportEmail}`}>{supportEmail}</a> with:
            </p>
            <pre class="template">Subject: {emailSubject}

user_name: &lt;your username&gt;
user_id: &lt;your ID code&gt;
</pre>
          </div>
        </section>

        <section aria-labelledby="data-heading">
          <h2 id="data-heading">What data is deleted vs kept</h2>
          <div class="data-grid">
            <div class="data-card">
              <h3>Deleted</h3>
              <ul>
                <li>Your {appOrDeveloperName} account and profile data associated with your username / ID code.</li>
                <li>Data you provided in the app that is associated with your account (if any).</li>
              </ul>
            </div>
            <div class="data-card">
              <h3>May be kept</h3>
              <ul>
                <li>Records required to comply with legal obligations or to resolve disputes (if applicable).</li>
                <li>Security, abuse-prevention, and operational records needed to protect the service.</li>
                <li>Aggregated or de-identified analytics that cannot reasonably be linked back to you.</li>
              </ul>
            </div>
          </div>

          <h3 class="retention">Retention / timeline</h3>
          <p class="small">
            We typically complete deletion within <strong>30 days</strong> after receiving a valid request. If we must retain certain records,
            we keep them only as long as necessary for the purposes above and then delete or anonymize them.
          </p>
        </section>
      </div>
    </section>
  </main>
</IndexLayout>

<style>
  .account-removal-page {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    padding: 2rem 0 4rem;
  }

  .hero-inner {
    max-width: 56rem;
    text-align: center;
  }

  .hero-inner h1 {
    margin: 0 0 0.75rem;
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    letter-spacing: -0.02em;
  }

  .hero-subtitle {
    margin: 0;
    color: var(--colors-ink-98, #F2EFFF);
    opacity: 0.95;
  }

  .content {
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--colors-ink-99, #FCF8FF);
    color: var(--text-primary);
  }

  .content-inner {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    padding: 2rem;
  }

  h2 {
    margin: 0 0 0.75rem;
    font-size: 1.25rem;
    color: var(--colors-ink-10);
  }

  h3 {
    margin: 0 0 0.5rem;
    font-size: 1rem;
    color: var(--colors-ink-10);
  }

  .steps {
    margin: 0;
    padding-left: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .small {
    margin: 0.75rem 0 0;
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.55;
  }

  .form-section {
    border-top: 1px solid var(--border);
    padding-top: 2rem;
  }

  .form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 0.75rem;
  }

  .form-row {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  label {
    font-weight: var(--font-weight-regular);
    font-size: 0.95rem;
  }

  input {
    padding: 0.85rem 1rem;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--colors-ink-100);
    color: var(--text-primary);
  }

  input::placeholder {
    color: var(--text-tertiary);
  }

  .submit {
    padding: 0.95rem 1.1rem;
    border-radius: 999px;
    border: 1px solid var(--colors-indigo-0);
    background: var(--colors-indigo-40);
    color: var(--colors-ink-100);
    font-weight: var(--font-weight-bold);
    cursor: pointer;
  }

  .submit:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  .form-message {
    margin: 0;
    min-height: 1.5rem;
    color: var(--text-secondary);
  }

  .email-fallback {
    margin-top: 1.25rem;
    padding-top: 1.25rem;
    border-top: 1px dashed var(--border);
  }

  .template {
    margin: 0.75rem 0 0;
    padding: 1rem;
    border-radius: 12px;
    background: var(--code-bg);
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    line-height: 1.45;
  }

  .data-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1rem;
    margin-top: 0.75rem;
  }

  .data-card {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    background: var(--colors-ink-100);
  }

  .data-card ul {
    margin: 0;
    padding-left: 1.25rem;
    color: var(--text-secondary);
    line-height: 1.55;
  }

  .retention {
    margin-top: 1.5rem;
  }

  @media (max-width: 768px) {
    .content-inner {
      padding: 1.5rem;
    }

    .data-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  const supportEmail = 'developer@totemgrid.dev'
  const emailSubject = 'Account Removal Request:'

  const form = document.getElementById('accountRemovalForm') as HTMLFormElement
  const message = document.getElementById('formMessage') as HTMLParagraphElement

  function setMessage(text: string) {
    message.textContent = text
  }

  form?.addEventListener('submit', (e) => {
    e.preventDefault()
    setMessage('')

    const formData = new FormData(form)
    const userName = String(formData.get('user_name') || '').trim()
    const userId = String(formData.get('user_id') || '').trim()

    if (!userName || !userId) {
      setMessage('Please enter both your username and your ID code.')
      return
    }

    const body = `user_name: ${userName}\nuser_id: ${userId}\n`
    const mailtoUrl = `mailto:${supportEmail}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(body)}`

    setMessage('Opening your email app with a pre-filled request…')
    window.location.href = mailtoUrl
  })
</script>
